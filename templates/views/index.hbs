<!DOCTYPE html>
<html lang="en">

<head>
  {{>header}}

  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyProject</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>document.getElementsByTagName("html")[0].className += " js";</script>
  <link rel="stylesheet" href="css/style2.css" />
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/cart.css" />
  <link rel="stylesheet" href="css/swiper.min.css" />
  <link href="sticky-footer-navbar.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      font-family: Verdana;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Source Sans Pro', sans-serif;
    }

    /* Navbar */
    nav {
      position: fixed;
      line-height: 1;
      overflow: hidden;
      background-color: rgb(0, 0, 0);
      z-index: 1;
    }

    .modal-header {
      height: 300x;
      width: 400px;
      margin: 4% 10%;
    }

    a.price {
      color: #020202;
    }

    .logsign {
      color: rgb(250, 250, 250) !important;
      margin-left: 15px;
      font-size: 1.2rem;
      font-weight: 400;
    }

    .nav-item a {
      color: rgb(250, 250, 250) !important;
      margin-left: 15px;
      font-size: 1.2rem;
      font-weight: 400;
    }

    .nav-item a:hover {
      text-decoration: underline;
      color: #198754 !important;
    }

    button {
      font-size: 1.2rem;
      width: 6rem;
    }

    h4 {
      font-family: 'Pacifico', cursive;
      margin: auto;
      color: #ddfdff;
      font-size: 2.5rem;
      font-weight: 800;
    }

    .content {
      padding: 16px;
    }

    .sticky {
      position: fixed;
      top: 0;
      width: 100%;
    }

    #buttonClose {
      position: absolute;
      right: 0.5rem;
      top: 0.5rem;
    }

    /* Searchbar  */
    .searchbar {
      padding: 20px;
      display: flex;

    }

    .searchbar input {
      background-image: url(https://cdn2.hubspot.net/hubfs/4004166/bioticresearch_website_assets/images/search_icon.png);
      background-repeat: no-repeat;
      background-position: left center;
      width: 602px;
      margin-left: 399px;
      text-align: center;
      height: inherit;
      border-radius: 30px;
      font-size: 16px;
      outline: none;
    }

    .searchbar button {
      width: 126px;
      padding: -12px 0px;
      text-align: center;
      border-radius: 31px;
      font-size: 17px;
      cursor: pointer;
      background-image: linear-gradient(to right, #020202, #4cef49);
    }

    ::placeholder {
      color: rgb(175, 172, 172);
    }

    /* offers */
    .offers {
      background-repeat: no-repeat;
      background-size: cover;
    }

    .offer1 {
      background: url("https://i0.wp.com/www.buymedicineonline.co.in/wp-content/uploads/2018/12/Medlife-Offers.jpg?fit=990%2C450&ssl=1") center no-repeat;
      background-size: cover;
      background-position: center;
      height: 800px;
    }

    .container1 {
      display: grid;
      height: auto;
      margin: 10px 400px;
      justify-content: center;
      grid-gap: 40px 120px;
      grid-template-columns: auto auto auto auto;
    }

    .item {
      width: 200px;
      height: 262px;
    }

    .item:hover {
      background-color: white;
    }

    .shoppingcart img {
      height: 3rem;
      width: 3rem;
      cursor: pointer;
    }

    .notification img {
      height: 2.8rem;
      width: 3rem;
      padding-left: 2rem;
      cursor: pointer;
    }

    /* The sticky class is added to the navbar with JS when it reaches its scroll position */
    .sticky {
      position: fixed;
      top: 0;
      width: 100%;
    }

    .position-sticky {
      position: sticky !important;
    }

    .footer_a {
      color: #ddfdff;
    }

    .footer_a:hover {
      color: greenyellow;
    }

    #upload-file {}

    .uploadingArea {
      position: relative;
      left: 45%;
    }

    #usernameLogin {
      position: absolute;
      right: 1rem;
    }
  </style>
  <script>
    var myCarousel = document.querySelector('#carouselExampleIndicators')
    var carousel = new bootstrap.Carousel(myCarousel, {
      interval: 500,
      wrap: false
    })
  </script>
</head>

<body>
  {{>navbar}}

  <main>
    <form class="searchbar">
      <input type="search" placeholder="Search your Medicine here..." />
      <button type="submit" class="btn btn-primary">Search</button>

      {{#each username}}
      <p id="usernameLogin" style="color: rgb(49, 177, 138); font-size: 1.2rem" onload="hideButton()">Welcome, {{this.firstname}}!</p>
      {{/each}}
    </form>
    <!-- Bootstrap carousel -->
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators" data-interval="500">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"
          aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
          aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
          aria-label="Slide 3"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3"
          aria-label="Slide 4"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4"
          aria-label="Slide 0"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active" data-bs-interval="3000">
          <img src="https://source.unsplash.com/1550x550/?pharmacy" class="d-block w-100" alt="First slide">
        </div>
        <div class="carousel-item" data-bs-interval="3000">
          <img src="https://source.unsplash.com/1550x550/?medicine" class="d-block w-100" alt="Second slide">
        </div>
        <div class="carousel-item" data-bs-interval="3000">
          <img src="https://source.unsplash.com/1550x550/?cornavirus" class="d-block w-100" alt="Third Slide">
        </div>
        <div class="carousel-item" data-bs-interval="3000">
          <img src="https://source.unsplash.com/1550x550/?prescription" class="d-block w-100" alt="Fourth Slide">
        </div>
        <div class="carousel-item" data-bs-interval="3000">
          <img src="https://source.unsplash.com/1550x550/?pharmaceutical" class="d-block w-100" alt="Fifth Slide">
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
        data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
        data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
    <!--precautions -->
    <div class="swiper-container">
      <div class="swiper-wrapper">
        <div class="swiper-slide-precaution">
          <div class="slider-box-precaution">
            <div class="img-box">
              <img src="/images/safety.png" />
            </div>
            <br>
            <p class="precaution-detail">
              4 Step Safety Practiced
            </p>
            <!-- <div class="cart">
                <a href="#" class="cd-add-to-cart js-cd-add-to-cart">Add To Cart</a>
              </div> -->
          </div>
        </div>
        <div class="swiper-slide-precaution">
          <div class="slider-box-precaution">
            <div class="img-box">
              <img src="images/temperature.png" />
            </div>
            <br>
            <p class="precaution-detail">
              Temperature Checks
            </p>
            <!-- <div class="cart">
                <a href="#" class="cd-add-to-cart js-cd-add-to-cart">Add To Cart</a>
              </div> -->
          </div>
        </div>
        <div class="swiper-slide-precaution">
          <div class="slider-box-precaution">
            <div class="img-box">
              <img src="images/secure.png" />
            </div>
            <br>
            <p class="precaution-detail">
              Secure Packaging
            </p>
            <!-- <div class="cart">
                <a href="#" class="cd-add-to-cart js-cd-add-to-cart">Add To Cart</a>
              </div> -->
          </div>
        </div>
        <div class="swiper-slide-precaution">
          <div class="slider-box-precaution">
            <div class="img-box">
              <img src="images/spray.png" />
            </div>
            <br>
            <p class="precaution-detail">
              Regular Sanitization
            </p>
            <!-- <div class="cart">
                <a href="#" class="cd-add-to-cart js-cd-add-to-cart">Add To Cart</a>
              </div> -->
          </div>
        </div>
        <div class="swiper-slide-precaution">
          <div class="slider-box-precaution">
            <div class="img-box">
              <img src="images/thermometer-gun.png" />
            </div>
            <br>
            <p class="precaution-detail">
              No Contact Delivery
            </p>
            <!-- <div class="cart">
                <a href="#" class="cd-add-to-cart js-cd-add-to-cart">Add To Cart</a>
              </div> -->
          </div>
        </div>
      </div>
    </div>
    <!-- Offers for you carousel -->
    <div class="heading">
      <h1>O F F E R S &emsp; F O R &emsp; Y O U</h1>
    </div>
    <div id="carouselExampleIndicators1" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators1" data-bs-slide-to="0" class="active"
          aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators1" data-bs-slide-to="1"
          aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators1" data-bs-slide-to="2"
          aria-label="Slide 0"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active" data-bs-interval="3000">
          <img src="images/offer1.PNG" class="d-block w-100" alt="First slide">
        </div>
        <div class="carousel-item" data-bs-interval="3000">
          <img src="images/offer2.PNG" class="d-block w-100" alt="Second slide">
        </div>
        <div class="carousel-item" data-bs-interval="3000">
          <img src="images/offer3.PNG" class="d-block w-100" alt="Third Slide">
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators1"
        data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators1"
        data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
    <!--Slider 1 Heading-->


    <!--Slider 1 Heading-->
    <div class="heading">
      <h1>PRODUCTS&emsp;</h1>
    </div>
    <!--Slider 1-->
    <div class="swiper-container">
      <div class="swiper-wrapper">
        {{#each details}}
        <div class="swiper-slide">
          <div class="slider-box">
            <div class="img-box" style="padding-top: 2rem;">
              <img class="shop-item-image" src="images/{{this.Medicinename}}.png">
            </div>
            <p class="detail shop-item-title" id="detail">
              {{this.Medicinename}}
            </p>
            <br>
            <span class="price shop-item-price">{{this.MRP}}</span>
            <span class="prescription" style="display: none;">{{this.Prescription}}</span>

            <div class="cart">
              <a onclick="return addToCart({{this.Medicinename}})" href="#cart" class="btn btn-primary shop-item-button"
                style="border-radius: 50px 0px 0px 50px;">Add to cart </a>

              <a href="/product?medname={{this.Medicinename}}&id={{this._id}}" class="btn btn-primary"
                style="border-left:1px solid #0d8bf2; border-radius: 0px 50px 50px 0px;">View Product</a>
            </div>
          </div>
        </div>
        {{/each}}
      </div>
    </div>
    <div class="uploadingArea">
      <label for="prescription-image">Upload your prescription here...</label>
      <br>
      <input style="padding-top: 1rem;" type="file" id="upload-file">
    </div>
  </main>
  <section style="margin-top: 1.5rem;" class="container content-section" id="cart">
    <h2 class="section-header">CART<img style="height: 3rem; padding-left: 0.5rem;" src="images/shopping-cart.png"
        alt="image-of-cart"></h2>
    <div class="cart-row">
      <span class="cart-item cart-header cart-column">ITEM</span>
      <span class="cart-price cart-header cart-column">PRICE</span>
      <span class="cart-quantity cart-header cart-column">QUANTITY</span>
    </div>
    <div class="cart-items">
    </div>
    <div class="cart-total">
      <strong class="cart-total-title">Total</strong>
      <SPAN>₹</SPAN>

      <span id="totalAmount" class="cart-total-price">0</span>
    </div>

    <div class="purchaseForm">
      <button class="btn btn-primary btn-purchase" type="submit" style="font-size: small;"
        id="rzp-button1">PURCHASE</button>
    </div>
  </section>

  {{>footer}}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
    crossorigin="anonymous"></script>
  <script src="js/swiper.min.js"></script>
  <script src="js/script.js"></script>
  <script>
    if (document.readyState == 'loading') {
      document.addEventListener('DOMContentLoaded', ready)
    } else {
      ready()
    }

    function ready() {
      var removeCartItemButtons = document.getElementsByClassName('btn-danger')
      for (var i = 0; i < removeCartItemButtons.length; i++) {
        var button = removeCartItemButtons[i]
        button.addEventListener('click', removeCartItem)
      }

      var quantityInputs = document.getElementsByClassName('cart-quantity-input')
      for (var i = 0; i < quantityInputs.length; i++) {
        var input = quantityInputs[i]
        input.addEventListener('change', quantityChanged)
      }

      var addToCartButtons = document.getElementsByClassName('shop-item-button')
      console.log(addToCartButtons);
      for (var i = 0; i < addToCartButtons.length; i++) {
        var button = addToCartButtons[i]
        button.addEventListener('click', addToCartClicked)
      }

      document.getElementsByClassName('btn-purchase')[0].addEventListener('click', purchaseClicked)
    }

    function purchaseClicked() {
      //alert('Thank you for your purchase')
      var cartItems = document.getElementsByClassName('cart-items')[0]
      while (cartItems.hasChildNodes()) {
        cartItems.removeChild(cartItems.firstChild)
      }
      updateCartTotal()
    }

    function removeCartItem(event) {
      var buttonClicked = event.target
      buttonClicked.parentElement.parentElement.remove()
      updateCartTotal()
    }

    function quantityChanged(event) {
      var input = event.target
      if (isNaN(input.value) || input.value <= 0) {
        input.value = 1
      }
      updateCartTotal()
    }

    function addToCartClicked(event) {
      var button = event.target
      var shopItem = button.parentElement.parentElement
      var presc = prescriptionChecker(shopItem.getElementsByClassName('prescription')[0].innerText)
      if (presc == 'True') {
        var title = shopItem.getElementsByClassName('shop-item-title')[0].innerText
        var price = shopItem.getElementsByClassName('shop-item-price')[0].innerText
        var imageSrc = shopItem.getElementsByClassName('shop-item-image')[0].src
        addItemToCart(title, price, imageSrc)
        updateCartTotal()
      }
    }

    function prescriptionChecker(prescriptionValue) {
      if (prescriptionValue == "Prescription Required") {
        var getName = document.getElementById('upload-file').value;
        var fName = getName.slice(12, getName.length);
        if (fName == '') {
          alert("Please upload your prescription in the button given below.")
          return "False";
        }
        else {
          alert("Your uploaded prescription " + fName + " will be verified for the chosen medicine.")
          return "True";
        }
      }
      else {
        return "True";
      }
    }

    function addItemToCart(title, price, imageSrc) {
      var cartRow = document.createElement('div')
      cartRow.classList.add('cart-row')
      var cartItems = document.getElementsByClassName('cart-items')[0]
      var cartItemNames = cartItems.getElementsByClassName('cart-item-title')
      for (var i = 0; i < cartItemNames.length; i++) {
        if (cartItemNames[i].innerText == title) {
          alert('This item is already added to the cart')
          return
        }
      }
      var cartRowContents = `
        <div class="cart-item cart-column">
            <img class="cart-item-image" src="${imageSrc}" width="100" height="100">
            <span class="cart-item-title">${title}</span>
        </div>
        <span class="cart-price cart-column"> ${price}</span>
        <div class="cart-quantity cart-column">
            <input class="cart-quantity-input" type="number" value="1">
            <button class="btn btn-danger" type="button">REMOVE</button>
        </div>`
      cartRow.innerHTML = cartRowContents
      cartItems.append(cartRow)
      cartRow.getElementsByClassName('btn-danger')[0].addEventListener('click', removeCartItem)
      cartRow.getElementsByClassName('cart-quantity-input')[0].addEventListener('change', quantityChanged)
    }

    function updateCartTotal() {
      var cartItemContainer = document.getElementsByClassName('cart-items')[0]
      var cartRows = cartItemContainer.getElementsByClassName('cart-row')
      var total = 0
      for (var i = 0; i < cartRows.length; i++) {
        var cartRow = cartRows[i]
        var priceElement = cartRow.getElementsByClassName('cart-price')[0]
        var quantityElement = cartRow.getElementsByClassName('cart-quantity-input')[0]
        var price = parseFloat(priceElement.innerText.replace('₹', ''))
        var quantity = quantityElement.value
        total = total + (price * quantity)
      }
      total = Math.round(total * 100) / 100
      document.getElementsByClassName('cart-total-price')[0].innerText = total
    }
  </script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    var orderId;
    $(document).ready(function () {
      var settings = {
        "url": "/create/orderId",
        "method": "POST",
        "timeout": 0,
        "headers": { "Content-Type": "application/json" },
        "data": JSON.stringify({
          "amount": "200"
        }),
      };

      //creates new orderId everytime
      $.ajax(settings).done(function (response) {
        orderId = response.orderId;
        console.log(orderId);
        $("button").show();
      });
    });

    document.getElementById('rzp-button1').onclick = function (e) {
      var options = {
        "key": "rzp_test_IAdXdrHNpx6X7G", // Enter the Key ID generated from the Dashboard
        "amount": document.getElementsByClassName('cart-total-price')[0].innerText * 100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "Online Pharma Store",
        "description": "Payment for your purchase",
        "image": "https://cdn.iconscout.com/icon/free/png-256/rupee-1795412-1522779.png",
        "order_id": orderId, //This is a sample Order ID. Pass the `id` obtained in the previous step
        "handler": function (response) {
          alert("Kindly note your payment ID for reference: " + response.razorpay_payment_id);
          //alert(response.razorpay_order_id);
          //alert(response.razorpay_signature)
        },
        "prefill": {
          "name": "Gaurav Kumar",
          "email": "gaurav.kumar@example.com",
          "contact": "9999999999"
        },
        "notes": {
          "address": "Razorpay Corporate Office"
        },
        "theme": {
          "color": "#3399cc"
        }
      };
      var rzp1 = new Razorpay(options);
      rzp1.on('payment.failed', function (response) {
        alert(response.error.code);
        alert(response.error.description);
        alert(response.error.source);
        alert(response.error.step);
        alert(response.error.reason);
        alert(response.error.metadata.order_id);
        alert(response.error.metadata.payment_id);
      });
      console.log(document.getElementsByClassName('cart-total-price')[0].innerText / 10000)

      rzp1.open();
      e.preventDefault();
    }
  </script>
  <script>
    if (document.getElementById('usernameLogin').innerText) {
      document.getElementsByClassName('btn btn-outline-success logsign')[0].style.display = "none";
      document.getElementsByClassName('btn btn-outline-success logsign')[1].style.display = "none";
      document.getElementsByClassName('btn btn-outline-success logsign')[2].style.display = "block";
    }
    else { }
  </script>

</body>

</html>